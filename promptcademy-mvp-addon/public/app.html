<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>PromptCademy App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/styles.css" />
  <style>
    :root { --ink: #0F172A; --muted: #475569; }
    body { font-family: Inter, system-ui, sans-serif; color: var(--ink); max-width: 920px; margin: 0 auto; padding: 24px; }
    .h1 { font-weight: 900; font-size: 40px; margin: 0 0 12px; }
    .h2 { font-weight: 800; font-size: 24px; margin: 24px 0 8px; }
    .card { border: 1px solid #e2e8f0; border-radius: 14px; padding: 16px; }
    .btn { display: inline-flex; gap: 8px; align-items: center; padding: 10px 14px; border-radius: 12px; background: #27AE60; color: #fff; border: none; cursor: pointer; }
    .btn + .btn { margin-left: 8px; }
    pre { white-space: pre-wrap; }
    .subtle { color: var(--muted); }
  </style>
</head>
<body>
  <h1 class="h1">Todayâ€™s Lesson</h1>
  <div id="lesson" class="card"></div>
  <div style="margin-top:12px;">
    <button id="start" class="btn">Mark Started</button>
    <button id="complete" class="btn">Mark Completed</button>
  </div>

  <h2 class="h2">Progress</h2>
  <pre id="progress" class="card"></pre>

<script>
async function fetchToday() {
  const r = await fetch('/api/lesson/today');
  const data = await r.json();
  if (!data.ok) { alert('Failed to load today lesson'); return null; }
  const lesson = data.lesson;
  document.getElementById('lesson').innerHTML =
    '<strong>' + lesson.title + '</strong><br>' +
    '<span class="subtle">Track: ' + lesson.track + '</span>' +
    '<p style="margin-top:8px;">' + lesson.content + '</p>' +
    '<small>ID: ' + lesson.id + '</small>';
  return lesson.id;
}

async function refreshProgress() {
  const r = await fetch('/api/progress/summary');
  const j = await r.json();
  document.getElementById('progress').textContent = JSON.stringify(j.items, null, 2);
}

let currentLessonId = null;
fetchToday().then(id => { currentLessonId = id; }).then(refreshProgress);

document.getElementById('start').onclick = async () => {
  if (!currentLessonId) return;
  await fetch('/api/progress', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ lessonId: currentLessonId, status: 'started' })
  });
  refreshProgress();
};
document.getElementById('complete').onclick = async () => {
  if (!currentLessonId) return;
  await fetch('/api/progress', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ lessonId: currentLessonId, status: 'completed' })
  });
  refreshProgress();
};
</script>
</body>
</html>
